
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="assets/img/favicon.png">
    <title>
      Dashboard
    </title>
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
    <!-- Nucleo Icons -->
    <link href="assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="assets/css/nucleo-svg.css" rel="stylesheet" />

    <!-- CSS Files -->
    <link id="pagestyle" href="assets/css/material-dashboard.css?v=3.8.0"
      rel="stylesheet" />
  </head>
  <style>
  .img-50
  {
    max-height:50px
  }
  .width-90{
    width:97%;
  }
</style>

  <body class="g-sidenav-show dark-version bg-gray-100">
    <aside
      class="sidenav navbar navbar-vertical navbar-expand-xs border-radius-lg fixed-start ms-2 my-2 ps bg-gradient-dark"
      id="sidenav-main">
      <div class="sidenav-header">
        <i
          class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
          aria-hidden="true" id="iconSidenav"></i>
          <hr>
        <a class="navbar-brand px-4 py-3 m-0" href="/" target="_blank">
          <img src="assets/images/logo-ct-dark.png" class="navbar-brand-img"
            width="26" height="26" alt="main_logo">
          <span class="ms-1 text-sm text-dark">Creative Tim</span>
        </a>
       
      </div>
      <hr class="horizontal dark mt-0 mb-2">
      <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active bg-gradient-dark text-white" href="/">
              <span class="nav-link-text ms-1">Dashboard</span>
            </a>
          </li>
        </ul>
      </div>
    </aside>
    <main
      class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
      <!-- Navbar -->

      <!-- End Navbar -->
      <div class="container-fluid py-2 mt-2">
        <div class="row width-90">
          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/park-disabled.png" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">Parking Break Indicator</h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0" id="park-break"></h5>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/check-disabled.PNG" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">Check Engine Indicator
                </h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0" id="check-engine"></h5>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/power-disabled.png" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">Motor Status Indicator
                </h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0 " id="motor-status"></h5>
              </div>
            </div>
          </div>
        </div>
        <hr>
        <hr>
        <div class="row width-90">
          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/battery-disabled.png" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">Battery Percentage
                </h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0 motor-status" id="percent"></h5>
              </div>
            </div>
          </div>

          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/temp.PNG" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">Battery Temprature</h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0" id="temp"></h5>
              </div>
            </div>
          </div>

          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/gear.PNG" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">Gear Ratio</h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0" id="gear-ratio"></h5>
              </div>
            </div>
          </div>
        </div>
        <hr>
        <hr>
        <div class="row width-90">

          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/power-disabled.png" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">RPM</h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0" id="rpm"></h5>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/power-disabled.png" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">Power Consumption
                </h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0" id="power-used"></h5>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-4">
            <div class="card">
              <div class="card-header mx-4 p-3 text-center">
                <div
                  class="icon icon-shape icon-lg bg-gradient-dark shadow text-center border-radius-lg">
                  <img src="assets/images/plugin-disabled.png" class="img-50">
                </div>
              </div>
              <div class="card-body pt-0 p-3 text-center">
                <h6 class="text-center mb-0">Charging State
                </h6>

                <hr class="horizontal dark my-3">
                <h5 class="mb-0 " id="charging"></h5>
              </div>
            </div>
          </div>

        </div>

        <footer class="footer py-4  ">
          <div class="container-fluid">
            <div class="row align-items-center justify-content-lg-between">
              <div class="col-lg-6 mb-lg-0 mb-4">
                <div
                  class="copyright text-center text-sm text-muted text-lg-start">
                  Â© <script>
                  document.write(new Date().getFullYear())
                </script>

                </div>
              </div>
              <div class="col-lg-6">

              </div>
            </div>
          </div>
        </footer>
      </div>
    </main>

    <!--   Core JS Files   -->

    <script type="module" >
          import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore,doc, collection,getDoc, onSnapshot,updateDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD_vTacVZzxVziS0e95Fi5JTMHq1DT_m0U",
        authDomain: "epiroc-dashboard.firebaseapp.com",
        databaseURL: "https://epiroc-dashboard-default-rtdb.firebaseio.com",
        projectId: "epiroc-dashboard",
        storageBucket: "epiroc-dashboard.firebasestorage.app",
        messagingSenderId: "453253762574",
        appId: "1:453253762574:web:80de8eaace834aa122765f",
        measurementId: "G-DZ5VYPQ9T1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const parkImg = document.getElementById("park-break");
    const checkEngine = document.getElementById("check-engine");
    const motorStatus = document.getElementById("motor-status");
    const percent = document.getElementById("percent");
    const gear_ratio = document.getElementById("gear-ratio");
    const rpm = document.getElementById("rpm");
    const powerused = document.getElementById("power-used");
    const temprature = document.getElementById("temp");
    const charging = document.getElementById("charging");

    //const batteryCharge=0;
    
    // Function to fetch and process data
    async function fetchAndDisplayData() {
        try {
            const response = await fetch("https://firestore.googleapis.com/v1/projects/epiroc-dashboard/databases/(default)/documents/dashboard");
            const data = await response.json();

            const batteryCharge = data.documents[0]?.fields?.battery_charge?.integerValue || "N/A";
            const parking = data.documents[0]?.fields?.parking?.booleanValue || false;
            const checkengine = data.documents[0]?.fields?.engine_status?.booleanValue || false;
            const motorstatus = data.documents[0]?.fields?.motor_status?.booleanValue || false;
            const batterylow = data.documents[0]?.fields?.battery_low?.booleanValue || false;
            const gearratio = data.documents[0]?.fields?.gear_ratio?.stringValue || "N/N";
            const rpmValue = data.documents[0]?.fields?.rpm?.stringValue || "0";
            const temp = data.documents[0]?.fields?.battery_temprature?.integerValue || "0";
            const charge = data.documents[0]?.fields?.charging?.booleanValue || "0";
            const powercons = data.documents[0]?.fields?.power_comsumption?.integerValue || "0";
            // Update the parking image based on the parking status
            parkImg.textContent = parking ? "ON" : "OFF";
            checkEngine.textContent = checkengine ? "ON" : "OFF";
            motorStatus.textContent = motorstatus ? "ON" : "OFF";
            percent.textContent =batteryCharge +"%";
            gear_ratio.textContent =gearratio ;
            rpm.textContent =rpmValue +" RPM" ;
            temprature.textContent =temp +" C" ;
           charging.textContent=charge;
           powerused.textContent=powercons;
            
        } catch (error) {
            console.error("Error fetching data:", error);
        }
    }

    function listenToRealtimeUpdates() {
    console.log("Setting up Firestore listener...");
    const collectionRef = collection(db, "dashboard");

    onSnapshot(collectionRef, (snapshot) => {
        console.log("Firestore snapshot received");
        if (snapshot.empty) {
            console.log("No documents in collection");
            return;
        }

        snapshot.forEach(doc => {
            console.log("Document data:", doc.data());
            parkImg.textContent = doc.data().parking ? "ON" : "OFF";
            checkEngine.textContent = doc.data().engine_status ? "ON" : "OFF";
            motorStatus.textContent = doc.data().motor_status ? "ON" : "OFF";
            percent.textContent =doc.data().battery_charge +"%";
            gear_ratio.textContent =doc.data().gear_ratio ;
            rpm.textContent =doc.data().rpm +" RPM" ;
            temprature.textContent =doc.data().battery_temprature +" C" ;
            charging.textContent=doc.data().charging? "ON" : "OFF";
            powerused.textContent=doc.data().power_comsumption;
        });

        // Add your UI update logic here...
    });
}

    // Initialize the app
    document.addEventListener("DOMContentLoaded", () => {
 
        fetchAndDisplayData();
        listenToRealtimeUpdates();
    });
      
    
    </script>

  </body>

</html>